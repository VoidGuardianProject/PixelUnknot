#!/usr/bin/python

import sys,getopt
import shutil

def tohex(block):
    str = ""
    for ch in block:
        str += hex(ord(ch))+" "
    return str

with open(sys.argv[1],"rb") as f:
    str = tohex(f.read(7))
    if str == '0xff 0xd8 0xff 0xdb 0x0 0x84 0x0 ':
        split = False
        str = tohex(f.read(64))
    elif str == '0xff 0xd8 0xff 0xe0 0x0 0x10 0x4a ':
        split = True
        str = tohex(f.read(18))
        if str != '0x46 0x49 0x46 0x0 0x1 0x1 0x0 0x0 0x1 0x0 0x1 0x0 0x0 0xff 0xdb 0x0 0x43 0x0 ':
            exit(0)
        str = tohex(f.read(64))
    else:
        exit(0)

    if str != '0x3 0x2 0x2 0x3 0x2 0x2 0x3 0x3 0x3 0x3 0x4 0x3 0x3 0x4 0x5 0x8 0x5 0x5 0x4 0x4 0x5 0xa 0x7 0x7 0x6 0x8 0xc 0xa 0xc 0xc 0xb 0xa 0xb 0xb 0xd 0xe 0x12 0x10 0xd 0xe 0x11 0xe 0xb 0xb 0x10 0x16 0x10 0x11 0x13 0x14 0x15 0x15 0x15 0xc 0xf 0x17 0x18 0x16 0x14 0x18 0x12 0x14 0x15 0x14 ':
        exit(0)

    if split:
        str = tohex(f.read(4))
        if str != '0xff 0xdb 0x0 0x43 ':
            exit(0)

    str = tohex(f.read(65))

    if str != '0x1 0x3 0x4 0x4 0x5 0x4 0x5 0x9 0x5 0x5 0x9 0x14 0xd 0xb 0xd 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 0x14 ':
        exit(0)

    str = tohex(f.read(5))
    if str != '0xff 0xc0 0x0 0x11 0x8 ':
        exit(0)

    f.read(4)

    str = tohex(f.read(10))
    if str != '0x3 0x1 0x22 0x0 0x2 0x11 0x1 0x3 0x11 0x1 ':
        exit(0)

    if split:
        f.read(432)
    else:
        f.read(420)

    str = tohex(f.read(5))
    if str != '0xff 0xda 0x0 0xc 0x3 ':
        exit(0)

    if split:
        print sys.argv[1] + " ==============================>>>>>>>>>>rewritten pixel knot header detected!!!"
    else:
        print sys.argv[1] + " ==============================>>>>>>>>>>original pixel knot header detected!!!"

    shutil.copy2(sys.argv[1],"./matches/")

